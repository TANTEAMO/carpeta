<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KOMYPE - Contact</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <!-- Estilos para transparencia en el formulario -->
  <style>
    .form-section input,
    .form-section textarea {
      background-color: rgba(255, 255, 255, 0.3); /* Fondo blanco con 80% de opacidad */
      transition: background-color 0.2s ease, border-color 0.2s ease, ring 0.2s ease;
    }

    .form-section input:focus,
    .form-section textarea:focus {
      background-color: rgba(255, 255, 255, 0.9); /* Ligeramente más opaco al enfocar */
      border-color: #4f46e5; /* Consistente con focus:ring-indigo-500 */
    }
  </style>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-17SDCHQMC8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-17SDCHQMC8');
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Cargar API de YouTube -->
  <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
  <div class="container">
    <main>
      <section class="intro-section" style="position: relative; width: 100%; min-height: 57vh; overflow: hidden;">
        <img src="images/sun.jpg" alt="Sun" style="width: 100%; height: 100%; object-fit: cover; opacity: 0.9;">
        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; color: 
        rgb(255, 255, 255); text-align: center; padding: 20px;">
          <h1>
            K<img src="images/komype-logo2.png" alt="Logo Tantema" class="logo" style="vertical-align: -1;">MYPE · CONTACT
          </h1>
          <div style="margin-top: 10px; display: flex; flex-direction: column; gap: 6px;">
            <span class="highlighted-title">
              <p class="text-lg text-gray-600 mt-2">Completa el formulario para cualquier consulta.</p>
          
            <section class="form-section max-w-lg mx-auto">
              <form action="mailto:hagojoa@gmail.com" method="post" enctype="text/plain" class="flex flex-col gap-4">
                <div>
                  <label for="name" class="block text-sm font-medium mb-1">Nombre</label>
                  <input type="text" id="name" name="name" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <div>
                  <label for="email" class="block text-sm font-medium mb-1">Correo Electrónico</label>
                  <input type="email" id="email" name="email" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <div>
                  <label for="message" class="block text-sm font-medium mb-1">Mensaje</label>
                  <textarea id="message" name="message" rows="5" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" required></textarea>
                </div>
                <button type="submit" class="bg-indigo-600 text-white py-2 px-4 rounded hover:bg-indigo-700 transition">Enviar Mensaje</button>
              </form>
            </section>
          
            </span>
          </div>
          <div  class="highlighted-title" style="margin-top: 10px; display: flex; flex-direction: column; gap: 6px;">
            <form method="get" action="https://www.google.com/search" target="_blank" class="search-area">
              <input type="text" name="q" placeholder="Buscar en Google..." required>
              <input type="submit" value="Buscar">
            </form>
            <div class="red-line" style="display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 10px; width: 100%;">
              <div style="flex: 3 1 480px; max-width: 100%; min-width: 240px; position: relative; padding-bottom: 27%;">
                  <iframe id="youtube-player" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.15);" 
                          src="https://www.youtube.com/embed/videoseries?list=PLLKpxsS4-8Nk54hR0u8m1foUvwneWZRDO&enablejsapi=1&autoplay=0" 
                          frameborder="0" 
                          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                          allowfullscreen></iframe>
              </div>
              
               
                 
          </div>
            
          </div>
        </div>
        
      </section>
      <div class="post-section">
        <div class="cajas">    
         <div class="cajas-box caja-a">
            <h1>Finance</h1>          
            <a href="https://cuantoestaeldolar.pe/" class="" target="_blank">Dolar</a>
            <a href="https://bbva.pe" class="" target="_blank">BBVA</a>
            <a href="https://www.viabcp.com/canales/banca-por-internet" class="" target="_blank">BCP</a>
           
          </div>
          <div class="cajas-box caja-b">
            <h1>Servicios</h1>
            <a href="https://news.google.com/" class="section-button" target="_blank">Google News</a>
            <a href="https://mi.claro.com.pe/" class="section-button" target="_blank">Claro</a>
            <a href="https://elcomercio.pe" class="section-button" target="_blank">El Comercio</a>
            <a href="https://calendar.google.com/" target="_blank" rel="noopener noreferrer">
              <img src="https://www.gstatic.com/images/branding/product/1x/calendar_48dp.png" alt="Google Calendar" width="28" height="28">
            </a>
            
            <a href="https://www.youtube.com" target="_blank" rel="noopener noreferrer">
              <img src="https://www.gstatic.com/images/branding/product/1x/youtube_48dp.png" alt="YouTube" width="28" height="28"> 
            </a>
            <a href="https://photos.google.com/" target="_blank" class="">
              <img src="https://www.gstatic.com/images/branding/product/1x/photos_48dp.png" alt="Google Photos Icon" width="28" height="28">
             </a>

             <a href="https://tantema.github.io/naraen/" target="_blank" class=""><img src="https://tantema.github.io/naraen/images/colibri-logo.jpg" alt="Google Photos Icon" width="28" height="28" style="transform: translateY(0px);">
           
          </div>
        
          <div class="cajas-box caja-c">
            <h1>IAs</h1>
            <a href="https://chatgpt.com/" class="section-button" target="_blank">ChatGPT</a>
            <a href="https://grok.com/" class="section-button" target="_blank">Grok</a>
            <a href="https://gemini.google.com/" class="section-button" target="_blank">Gemini</a>
            <a href="https://chat.deepseek.com/" class="section-button" target="_blank">Deepseek</a>
            <a href="https://gemini.google.com/" class="section-button" target="_blank">Gemini</a>
            <a href="https://claude.ai/" class="section-button" target="_blank">Clude</a>
            <a href="https://chat.qwen.ai/" class="section-button" target="_blank">Qwen</a>
          </div>
        </div>
      </div>
      
  </div>
      
      <!--section class="blog-feed" id="blog-feed"></section-->
      <div id="post-container" style="display: none;"></div>
    </main>
  </div>

  <!-- Scripts -->
  <script src="navbar.js"></script>
  <script>
    let ytPlayer = null;

    function onYouTubeIframeAPIReady() {
      console.log('API de YouTube cargada');
    }

    function setupYouTubePlayer(iframe) {
      if (!iframe) {
        console.error('No se encontró el iframe de YouTube');
        return;
      }
      ytPlayer = new YT.Player(iframe, {
        playerVars: {
          autoplay: 0,
          enablejsapi: 1
        },
        events: {
          'onReady': () => {
            console.log('Reproductor inicializado:', ytPlayer);
            setupLinks();
          }
        }
      });
    }

    function setupLinks() {
      console.log('Configurando enlaces play-in-frame');
      const links = document.querySelectorAll('.play-in-frame');
      console.log('Enlaces encontrados:', links.length);
      
      links.forEach(link => {
        if (link.dataset.listener) return;
        
        link.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          console.log('Clic en enlace:', link.href, 'data-video-id:', link.dataset.videoId);
          
          const videoId = link.dataset.videoId || extractVideoId(link.href);
          console.log('Video ID:', videoId);
          
          if (videoId && ytPlayer) {
            console.log('Cargando video con ID:', videoId);
            ytPlayer.loadVideoById(videoId);
            document.getElementById('youtube-player').scrollIntoView({ behavior: 'smooth', block: 'center' });
          } else {
            console.error('Error: No se pudo cargar el video', { videoId, ytPlayer });
          }
        });
        
        link.dataset.listener = 'true';
      });
    }

    function extractVideoId(url) {
      const match = url.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([^&?]+)/);
      return match ? match[1] : null;
    }

    document.addEventListener('DOMContentLoaded', async () => {
  const blogFeed = document.getElementById('blog-feed');
  const postContainer = document.getElementById('post-container');
  const introSection = document.querySelector('.intro-section');
  const postSection = document.querySelector('.post-section');

  // Observar cambios en postContainer para detectar inserción de songs.html
  const observer = new MutationObserver((mutations) => {
    mutations.forEach(mutation => {
      if (mutation.addedNodes.length) {
        const youtubePlayer = postContainer.querySelector('#youtube-player');
        if (youtubePlayer) {
          console.log('iframe youtube-player detectado');
          setupYouTubePlayer(youtubePlayer);
        }
      }
    });
  });
  observer.observe(postContainer, { childList: true, subtree: true });

  // Cargar posts locales desde posts.json
  async function loadLocalPosts() {
    try {
      const res = await fetch('posts.json');
      if (!res.ok) throw new Error('Error al cargar los posts');
      const posts = await res.json();

      blogFeed.innerHTML = '';
      const filteredPosts = posts.filter(post => post.visibleInIndex ?? true);
      filteredPosts.forEach(post => {
        blogFeed.insertAdjacentHTML('beforeend', `
          <article class="post-preview" data-post="${post.post}">
            <img src="${post.image}" alt="${post.title}" class="post-image">
            <div class="post-excerpt">
              <h2>${post.title}</h2>
              <p>${post.description}</p>
              <button class="read-more">Leer más</button>
            </div>
          </article>
        `);
      });

      document.querySelectorAll('.post-preview[data-post]').forEach(preview => {
        preview.addEventListener('click', async (e) => {
          e.preventDefault();
          const postFile = preview.dataset.post;
          if (!postFile) return;

          try {
            const postRes = await fetch(postFile);
            if (!postRes.ok) throw new Error('Post no encontrado');
            const postHTML = await postRes.text();

            // Ocultar secciones intro y post
            introSection.style.display = 'none';
            postSection.style.display = 'none';
            
            // Ocultar el feed y mostrar el contenido del post
            blogFeed.style.display = 'none';
            postContainer.innerHTML = `
              <button id="back-button-top" class="back-button">← Volver</button>
              ${postHTML}
              <button id="back-button-bottom" class="back-button">← Volver</button>
            `;
            postContainer.style.display = 'block';

            // Cargar gráficos si existen
            const postData = posts.find(post => post.post === postFile);
            if (postData?.charts?.length) {
              postData.charts.forEach(chart => {
                const script = document.createElement('script');
                script.text = `
                  setTimeout(() => {
                    const canvas = document.getElementById('${chart.id}');
                    if (canvas) {
                      new Chart(canvas.getContext('2d'), {
                        type: '${chart.type}',
                        data: ${JSON.stringify(chart.data)},
                        options: ${JSON.stringify(chart.options)}
                      });
                    }
                  }, 100);
                `;
                document.body.appendChild(script);
              });
            }

            window.scrollTo({ top: 0, behavior: 'smooth' });

            const volver = () => {
              // Mostrar secciones intro y post nuevamente
              introSection.style.display = 'block';
              postSection.style.display = 'block';
              
              // Ocultar el post y mostrar el feed
              postContainer.style.display = 'none';
              postContainer.innerHTML = '';
              blogFeed.style.display = 'grid';
              window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            document.getElementById('back-button-top').addEventListener('click', volver);
            document.getElementById('back-button-bottom').addEventListener('click', volver);
          } catch (error) {
            console.error('Error al cargar el post:', error);
            postContainer.innerHTML = '<p class="error">Error al cargar el post.</p>';
          }
        });
      });
    } catch (error) {
      console.error('Error al cargar los posts:', error);
      blogFeed.innerHTML = '<p class="error">Error al cargar los posts.</p>';
    }
  }

  // Cargar feeds de Google News
  async function loadNewsFeed() {
    const rssUrl = 'https://news.google.com/rss/search?q=(peru+AND+(corea+del+sur+OR+hyundai+OR+samsung+OR+posco+dohwa+OR+fame+OR+seman+OR+marina+de+guerra+OR+fap+OR+inversiones+coreanas+OR+cooperaci%C3%B3n+coreana+OR+naval+OR+alianza+estrat%C3%A9gica))&hl=es-419&gl=PE&ceid=PE:es';
    try {
      const response = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`);
      const data = await response.json();

      if (data.status === 'ok' && data.items.length > 0) {
        const sixMonthsAgo = new Date();
        sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);

        const recentItems = data.items
          .filter(item => new Date(item.pubDate) >= sixMonthsAgo)
          .sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));

        if (recentItems.length > 0) {
          recentItems.forEach(item => {
            let imageSrc = '';
            if (item.enclosure?.link) {
              imageSrc = item.enclosure.link;
            } else if (item.content) {
              const imgMatch = item.content.match(/<img[^>]+src=["']([^"']+)["']/i);
              if (imgMatch) imageSrc = imgMatch[1];
            } else if (item.description) {
              const imgMatch = item.description.match(/<img[^>]+src=["']([^"']+)["']/i);
              if (imgMatch) imageSrc = imgMatch[1];
            }

            if (imageSrc) {
              imageSrc = imageSrc.split('?')[0].replace(/^http:\/\//i, 'https://');
            }

            const imageHtml = imageSrc 
              ? `<img src="${imageSrc}" alt="${item.title}" class="post-image" onerror="this.parentNode.innerHTML='<div class=\\'no-image-placeholder\\'>Imagen no disponible</div>'">`
              : '<div class="no-image-placeholder" style="margin-top: 10px;"></div>';

            blogFeed.insertAdjacentHTML('beforeend', `
              <article class="post-preview">
                ${imageHtml}
                <div class="post-excerpt">
                  <h2><a href="${item.link}" target="_blank">${item.title}</a></h2>
                  <p>${item.description?.replace(/<[^>]+>/g, '').substring(0, 150) || 'Sin descripción disponible'}...</p>
                  <p class="meta">Publicado: ${new Date(item.pubDate).toLocaleDateString('es-PE', { dateStyle: 'medium' })}</p>
                  <button class="read-more" onclick="window.open('${item.link}', '_blank')">Leer más</button>
                </div>
              </article>
            `);
          });
        } else {
          blogFeed.insertAdjacentHTML('beforeend', '<p class="error">No se encontraron noticias recientes de los últimos 6 meses.</p>');
        }
      } else {
        blogFeed.insertAdjacentHTML('beforeend', '<p class="error">No se encontraron noticias recientes.</p>');
      }
    } catch (error) {
      console.error('Error al cargar las noticias:', error);
      blogFeed.insertAdjacentHTML('beforeend', '<p class="error">Error al cargar las noticias.</p>');
    }
  }

  await loadLocalPosts();
  await loadNewsFeed();

  setInterval(async () => {
    const localPosts = document.querySelectorAll('.post-preview[data-post]');
    blogFeed.innerHTML = '';
    localPosts.forEach(post => blogFeed.appendChild(post));
    await loadNewsFeed();
  }, 30 * 60 * 1000);
});
  </script>
</body>
</html>