<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TANTEMA - Explora</title>
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-17SDCHQMC8"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-17SDCHQMC8');
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
    <div>
        <main>
            <!-- Añadida clase intro-section para poder ocultar/mostrar -->
            <section class="intro-section" style="position: relative; width: 100%; min-height: 950px; overflow: hidden; background-color: #f4f4f4;">
                <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center; padding: 20px;">
                  <section class="post-header" style="max-width: 1200px; margin: 0 auto; padding: 60px 20px; text-align: center;">
                    <h1 style="font-size: 2.5em; margin-bottom: 20px;">Our Services</h1>
                    <p>
                      At KOMYPE, we offer comprehensive services designed to facilitate strategic partnerships and business success.
                    </p>
                  </section>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 40px;">
                      <div style="padding: 20px; border: 1px solid #eee; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        <h2 style="font-size: 1.5em; margin-bottom: 15px;">Strategic Business Consulting</h2>
                        <ul style="list-style: none; padding: 0; color: #666; line-height: 1.6;">
                          <li>Market research and feasibility studies</li>
                          <li>Business development strategies</li>
                          <li>Regulatory and legal guidance</li>
                        </ul>
                      </div>
                      
                      <div style="padding: 20px; border: 1px solid #eee; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        <h2 style="font-size: 1.5em; margin-bottom: 15px;">Strategic Alliances and Partnerships</h2>
                        <ul style="list-style: none; padding: 0; color: #666; line-height: 1.6;">
                          <li>Partner identification and connection</li>
                          <li>Negotiation support</li>
                          <li>Joint venture facilitation</li>
                        </ul>
                      </div>
                      
                      <div style="padding: 20px; border: 1px solid #eee; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        <h2 style="font-size: 1.5em; margin-bottom: 15px;">Local Representation and Support</h2>
                        <ul style="list-style: none; padding: 0; color: #666; line-height: 1.6;">
                          <li>Establishment of local offices</li>
                          <li>Operational and administrative support</li>
                        </ul>
                      </div>
                      
                      <div style="padding: 20px; border: 1px solid #eee; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        <h2 style="font-size: 1.5em; margin-bottom: 15px;">Trade and Investment Promotion</h2>
                        <ul style="list-style: none; padding: 0; color: #666; line-height: 1.6;">
                          <li>Support for imports and exports</li>
                          <li>Business missions and trade events</li>
                        </ul>
                      </div>
                      
                      <div style="padding: 20px; border: 1px solid #eee; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        <h2 style="font-size: 1.5em; margin-bottom: 15px;">Cultural and Communication Advisory</h2>
                        <ul style="list-style: none; padding: 0; color: #666; line-height: 1.6;">
                          <li>Cross-cultural business training</li>
                          <li>Translation and interpretation services</li>
                        </ul>
                      </div>
                      
                      <div style="padding: 20px; border: 1px solid #eee; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        <h2 style="font-size: 1.5em; margin-bottom: 15px;">Administrative and Relocation Support</h2>
                        <ul style="list-style: none; padding: 0; color: #666; line-height: 1.6;">
                          <li>Comprehensive services for company registration, office legalization, and foreign residency permits (carnet de extranjería)</li>
                          <li>Support for accommodation, transportation, and essential administrative procedures</li>
                        </ul>
                      </div>
                    </div>
                    
                    <p style="margin-top: 60px; font-size: 1.4em; font-style: italic; color: #333;">
                      "Bridging barriers, empowering businesses."
                    </p>
                  
                </div>
              </section>
              
            <section class="blog-feed" id="blog-feed"></section>
            <div id="post-container" style="display: none;"></div>
        </main>
    </div>

    <script src="navbar.js"></script>

    <script>
        let ytPlayer = null;

        function onYouTubeIframeAPIReady() {
            console.log('API de YouTube cargada en explora.html');
        }

        function setupYouTubePlayer(iframe) {
            if (!iframe) {
                console.error('No se encontró el iframe de YouTube en el post.');
                return;
            }
            ytPlayer = new YT.Player(iframe, {
                playerVars: {
                    autoplay: 0,
                    enablejsapi: 1
                },
                events: {
                    'onReady': () => {
                        console.log('Reproductor de YouTube inicializado en el post:', ytPlayer);
                        setupLinks();
                    }
                }
            });
        }

        function setupLinks() {
            console.log('Configurando enlaces play-in-frame en el post.');
            const links = document.querySelectorAll('#post-container .play-in-frame');
            console.log('Enlaces encontrados en el post:', links.length);

            links.forEach(link => {
                if (link.dataset.listener) return;

                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Clic en enlace del post:', link.href, 'data-video-id:', link.dataset.videoId);

                    const videoId = link.dataset.videoId || extractVideoId(link.href);
                    console.log('Video ID del post:', videoId);

                    const youtubePlayerIframe = document.getElementById('youtube-player');
                    if (videoId && ytPlayer && youtubePlayerIframe) {
                        console.log('Cargando video con ID:', videoId);
                        ytPlayer.loadVideoById(videoId);
                        youtubePlayerIframe.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else {
                        console.error('Error: No se pudo cargar el video en el post', { videoId, ytPlayer, youtubePlayerIframe });
                    }
                });

                link.dataset.listener = 'true';
            });
        }

        function extractVideoId(url) {
            const match = url.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([^&?]+)/);
            return match ? match[1] : null;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const blogFeed = document.getElementById('blog-feed');
            const postContainer = document.getElementById('post-container');
            const introSection = document.querySelector('.intro-section');

            try {
                const res = await fetch('posts.json');
                if (!res.ok) throw new Error('Error al cargar los posts');
                const posts = await res.json();

                // Filtrar posts con label "explora"
                const filteredPosts = posts.filter(post => post.label === 'explora');

                blogFeed.innerHTML = filteredPosts.map(post => `
                    <article class="post-preview" data-post="${post.post}">
                        <img src="${post.image}" alt="${post.title}" class="post-image">
                        <div class="post-excerpt">
                            <h2>${post.title}</h2>
                            <p>${post.description}</p>
                            <button class="read-more">Leer más</button>
                        </div>
                    </article>
                `).join('');

                // Eventos de clic para leer el post (imagen o botón)
                document.querySelectorAll('.post-preview').forEach(preview => {
                    preview.addEventListener('click', async (e) => {
                        e.preventDefault();

                        const postFile = preview.dataset.post;
                        const postRes = await fetch(postFile);
                        if (!postRes.ok) throw new Error('Post no encontrado');
                        const postHTML = await postRes.text();

                        // Ocultar sección de introducción
                        introSection.style.display = 'none';
                        
                        // Ocultar el feed y mostrar el contenido del post
                        blogFeed.style.display = 'none';
                        postContainer.innerHTML = `
                            <button id="back-button-top" class="back-button">← Volver</button>
                            ${postHTML}
                            <button id="back-button-bottom" class="back-button">← Volver</button>
                        `;
                        postContainer.style.display = 'block';

                        // Buscar y configurar el reproductor de YouTube si existe en el post cargado
                        const youtubePlayerIframe = postContainer.querySelector('#youtube-player');
                        if (youtubePlayerIframe) {
                            console.log('iframe youtube-player detectado en el post cargado en explora.html');
                            setupYouTubePlayer(youtubePlayerIframe);
                        }

                        // Cargar gráficos si el post tiene charts definidos en posts.json
                        const postData = posts.find(post => post.post === postFile);
                        if (postData && postData.charts && postData.charts.length > 0) {
                            postData.charts.forEach(chart => {
                                const script = document.createElement('script');
                                script.innerHTML = `
                                    setTimeout(() => {
                                        const canvas = document.getElementById('${chart.id}');
                                        if (canvas) {
                                            const ctx = canvas.getContext('2d');
                                            new Chart(ctx, {
                                                type: '${chart.type}',
                                                data: ${JSON.stringify(chart.data)},
                                                options: ${JSON.stringify(chart.options)}
                                            });
                                        }
                                    }, 100);
                                `;
                                document.body.appendChild(script);
                            });
                        }

                        // Scroll suave
                        window.scrollTo({ top: 0, behavior: 'smooth' });

                        // Volver desde arriba o abajo
                        const volver = () => {
                            // Mostrar sección de introducción nuevamente
                            introSection.style.display = 'block';
                            
                            // Ocultar el post y mostrar el feed
                            postContainer.style.display = 'none';
                            postContainer.innerHTML = '';
                            blogFeed.style.display = 'grid';
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        };

                        document.getElementById('back-button-top').addEventListener('click', volver);
                        document.getElementById('back-button-bottom').addEventListener('click', volver);
                    });
                });

            } catch (error) {
                console.error('Error al cargar los posts:', error);
            }
        });
    </script>
</body>
</html>